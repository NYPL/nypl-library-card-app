language: node_js
node_js:
  - "10"
cache:
  directories:
    - node_modules
install: npm install
script: npm test
before_deploy: echo 'All unit tests passed;
  Preparing to deploy Get a Library Card to AWS'
deploy:
  - provider: elasticbeanstalk
    skip_cleanup: true
    access_key_id: "$AWS_ACCESS_KEY_ID_PRODUCTION"
    secret_access_key: "$AWS_SECRET_ACCESS_KEY_PRODUCTION"
    region: us-east-1
    app: nypl-library-card-app
    env: nypl-library-card-app-production-2
    bucket_name: elasticbeanstalk-us-east-1-946183545209
    bucket_path: nypl-library-card-app-production
    on:
      repo: NYPL/nypl-library-card-app
      branch: production
  - provider: elasticbeanstalk
    skip_cleanup: true
    access_key_id: "$AWS_ACCESS_KEY_ID_PRODUCTION"
    secret_access_key: "$AWS_SECRET_ACCESS_KEY_PRODUCTION"
    region: us-east-1
    app: nypl-library-card-app
    env: nypl-library-card-app-qa-18
    bucket_name: elasticbeanstalk-us-east-1-946183545209
    bucket_path: nypl-library-card-app-qa
    on:
      repo: NYPL/nypl-library-card-app
      branch: qa-v2-update
# Disabling development deploy for cost savings
# - provider: elasticbeanstalk
#  skip_cleanup: true
#  access_key_id: "$AWS_ACCESS_KEY_ID_DEVELOPMENT"
#  secret_access_key: "$AWS_SECRET_ACCESS_KEY_DEVELOPMENT"
#  region: us-east-1
#  app: nypl-library-card-app
#  env: nypl-library-card-app-development
#  bucket_name: elasticbeanstalk-us-east-1-224280085904
#  bucket_path: nypl-library-card-app-development
#  on:
#    repo: NYPL/nypl-library-card-app
#    branch: main
after_deploy:
  echo 'Successfully executed deploy trigger for Get a Library Card on
  AWS'
env:
  global:
    - secure: GkM3jfBDIHZo1JuWurHYtzDif5ePAVnTO/BukCkjZL6+Pi/i1itDUI6NeCtgJLshtzWz6Ys5ZdOjxP+Ky35/i6TN3gCy8rKpcP/DY+OhefzMQSiA7IlmZbNLvVbXQVr17A2kr/5eP6aEP6vR5lApJ1wkC78Iw/PDry1m/WT/LhZojKOF2Akbfbqjtt1qRNErHVdlcb2OGQCmCwEowOZRpNpM8O+h0SHmcWyA0+TqCCS6czMANOpkyK1Gfl8zWrsSe8F3T1fNjEkFaxp/seFy+e1MUsl9IvN2NVl05k7CZTOOjptcMVzR0sqz2SUKUM5WADIWgdMBpOzXQRzgLzKnqm7+mWUCTAjZZZN1scL2ggCxxZn6kf6HZsjTDltPuYHzU+FJeqGzPisvKlVW8it6KfBbJvIgJP+R9JrI9foPfZbH5nrdkkQSlLZIMJT7FeyPizMSdSZ6lTxJhtXAefchBkSeDknUo0qdfFdjTpjbcvNtnt7WUVTAWVI2NrzgXWq9mVJ52pSft9ShbiJKi3KvsXBcfoWb0ZxmKetEZU0XblIhTmGi7oiFdtdodWGowpNfvSVQX9mSHGysNyz+sJSAX8BDmn6D5HASgc/l2RI91rSUReUMoyKzAQ9+BI1Zav+5fLGDNmvyA4xsSth/WaJQPUUy95nyiIsXq72ViN1MDrE=
