language: node_js
node_js:
  - "10"
cache:
  directories:
    - node_modules
install: npm install
script: npm test
before_deploy: echo 'All unit tests passed;
  Preparing to deploy Get a Library Card to AWS'
deploy:
  - provider: elasticbeanstalk
    skip_cleanup: true
    access_key_id: "$AWS_ACCESS_KEY_ID_PRODUCTION"
    secret_access_key: "$AWS_SECRET_ACCESS_KEY_PRODUCTION"
    region: us-east-1
    app: nypl-library-card-app
    env: nypl-library-card-app-production-2
    bucket_name: elasticbeanstalk-us-east-1-946183545209
    bucket_path: nypl-library-card-app-production
    on:
      repo: NYPL/nypl-library-card-app
      branch: production
  - provider: elasticbeanstalk
    skip_cleanup: true
    access_key_id: "$AWS_ACCESS_KEY_ID_PRODUCTION"
    secret_access_key: "$AWS_SECRET_ACCESS_KEY_PRODUCTION"
    region: us-east-1
    app: nypl-library-card-app
    env: nypl-library-card-app-qa-18
    bucket_name: elasticbeanstalk-us-east-1-946183545209
    bucket_path: nypl-library-card-app-qa
    on:
      repo: NYPL/nypl-library-card-app
      branch: qa
# Disabling development deploy for cost savings
# - provider: elasticbeanstalk
#  skip_cleanup: true
#  access_key_id: "$AWS_ACCESS_KEY_ID_DEVELOPMENT"
#  secret_access_key: "$AWS_SECRET_ACCESS_KEY_DEVELOPMENT"
#  region: us-east-1
#  app: nypl-library-card-app
#  env: nypl-library-card-app-development
#  bucket_name: elasticbeanstalk-us-east-1-224280085904
#  bucket_path: nypl-library-card-app-development
#  on:
#    repo: NYPL/nypl-library-card-app
#    branch: main
after_deploy:
  echo 'Successfully executed deploy trigger for Get a Library Card on
  AWS'
env:
  global:
    - secure: "mo/ttOHApaC244J0jE8fRWeP4v/vYJ0Z9vARk4mL0bipOGWTrYZ8kY7sr61vtao0LuivaWL0gP9A9uZYmi2ggoORKRtU6j2UwBGYrfXWsNcO8d/d9dAdUR+2+VaIOf6//G8FWmWBNAIMOGFdYf+AunvcJzmA1nuGlspwLfoYVgkHc1XeVSZ9kYJ0cBvamq8oQf5IogVnU4K7Go4unLZPwjbw0w2Cc6hAx9YQdZVL86WuiQYPMGtjPLaZhoyqN93jCJmlXpArw+1289jwXKkBXlzeKNIDR7LdROqH6fHhN5RD/FG1ErK99rQJpgYpPmxh+RGQqd/JMpCLGvElztG+LVFHBkiaJhvSC2din/t06bnIJgsJ8yiXj4GfehkHwilrrAKYYqMp7WQEuPM0WOYF2GNsm0YSqmqUSYp5bwJmf+Z5+/CMEgKTVcUccDkRW+3jhmQPf9nWTMC4pa/oiGzyGGMcxcCsRMzgoxy/lAgKkOU10BOU+k/QoVng60gBQYdU1cXfP1D4cwziTqHbD7+VvK23Y3lZy8+nIuYm6yDbgtDc5qpwIKRYghfDmU4jS8dlasBwsOxbCSE60TIQ/kgoNkiWQxjeE80Ud4+Xjl5BcdDFffYq1F59TX0hclWmIsoRqx8mqePZlOOhzYGOA3V9Q7X0Gp8VXZo2kapd97eC0s0="
