name: Playwright Tests
on: pull_request
jobs:
 test:
   timeout-minutes: 60
   runs-on: ubuntu-latest
   steps:
   - uses: actions/checkout@v4
   - uses: actions/setup-node@v4
     with:
       node-version-file: '.nvmrc'
       cache: 'npm'
       cache-dependency-path: 'package-lock.json'
   - name: Configure AWS credentials
     uses: aws-actions/configure-aws-credentials@v2
     with:
       role-to-assume: arn:aws:iam::946183545209:role/GithubActionsDeployerRole
       aws-region: us-east-1
   - name: Install dependencies
     run: npm ci

   - name: Install Playwright Browsers
     run: npx playwright install --with-deps

   - name: Run Playwright tests
     run: npx playwright test

   - name: Upload Playwright reports on failure
     if: ${{ failure() }}
     uses: actions/upload-artifact@v4
     with:
       name: playwright-report
       path: playwright-report/
       retention-days: 3